!function(e){"use strict";var t=e.module("ngLoadScript",[]);t.directive("script",function(){return{restrict:"E",scope:!1,link:function(e,t,n){if("text/javascript-lazy"===n.type){var r=t.text(),o=new Function(r);o()}}}})}(angular),angular.module("HashBangURLs",[]).config(["$locationProvider",function(e){e.hashPrefix("!")}]);var module=angular.module("app",["ngCookies","ngRoute","HashBangURLs"]);module.directive("script",function(){return{restrict:"E",scope:!1,link:function(e,t,n){if("text/javascript-lazy"===n.type){var r=document.createElement("script");r.type="text/javascript";var o=t.attr("src");if(void 0!==o)r.src=o;else{var c=t.text();r.text=c}document.head.appendChild(r),t.remove()}}}}),module.config(["$locationProvider",function(){}]),module.config(function(e){e.when("/",{templateUrl:"/templates/holders/homeHolder.html",controller:"InfoCtrl"}).when("/{ver}",{templateUrl:"/templates/holders/homeHolder.html",controller:"InfoCtrl"}).when("/Billing",{templateUrl:"/templates/contents/billing.html",controller:"CcCtrl"}).when("/success",{templateUrl:"/templates/contents/success.html",controller:"SuccessCtrl"}).when("/upsell",{templateUrl:"/templates/contents/upsell.php",controller:"UpCtrl"}).otherwise({redirectTo:"/"})}),module.filter("range",function(){var e=function(e,t,n){for(var r=t;n>=r;r++)e.push(r);return e};return e}),module.filter("to_trusted",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),module.directive("cardExpiration",function(e){var t={require:"ngModel",link:function(t){t.$watch("[ccinfo.expMonth,ccinfo.expYear]",function(){return""!=t.ccinfo.expMonth&&""!=t.ccinfo.expYear&&(today=new Date,selected=new Date,selected.setMonth(t.ccinfo.expMonth),selected.setYear(t.ccinfo.expYear),today>=selected)?(e.alert("Please select a valid date!"),t.ccinfo.expYear="",t.ccinfo.expMonth="",!1):!0},!0)}};return t}),module.directive("staticInclude",["$http","$templateCache","$compile","$timeout",function(e,t,n,r){return function(o,c,i){r(function(){var r=i.staticInclude;e.get(r,{cache:t}).success(function(e){var t=c.html(e).contents();n(t)(o)})},"1500")}}]),module.directive("onlyDigits",function(){return{require:"ngModel",restrict:"A",link:function(e,t,n,r){function o(e){if(e){var t=e.replace(/[^0-9]/g,"");return t!==e&&(r.$setViewValue(t),r.$render()),parseInt(t,10)}return void 0}r.$parsers.push(o)}}}),module.factory("AlertHandler",function(){return{alert:function(e){jError("<div>We are sorry but we could not process your request.<br/><h2>"+e+"</h2>Please correct and try again.</div>",{autoHide:!0,TimeShown:3e3,HorizontalPosition:"center",onCompleted:function(){}})}}}),module.factory("ServiceHandler",["$http",function(e){return{post:function(t,n){return e.post("TriangleCRM/Controller.php",{action:t,data:n})}}}]),module.factory("BakeCookie",function(e){return{set:function(t,n){e.put(t,n)},remove:function(t){e.remove(t)},get:function(t){return e.get(t)}}}),module.factory("encrypt",function(){return{encryptData:function(e){var t="-----BEGIN PUBLIC KEY-----MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAM1RXGYKyXlCGcGvFYeNCD+yzVAOoK+w2awyE6vOCSqhR0pAWFgpWOuwbrL5M78PILmZc85ipbzoz6Vtv4IvYJUCAwEAAQ==-----END PUBLIC KEY-----",n=RSA.getPublicKey(t);return RSA.encrypt(e,n)}}}),module.factory("ParameterByName",function(){return{get:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))}}}),module.factory("ServicePixel",["$http","$routeParams",function(e,t){return{get:function(n,r){var o={};return o.affiliate=t.aff||"",o.clickId=t.click_id||"",o.pageTypeID=n,o.prospectID=r,jsonObj=JSON.stringify(o),e.post("TriangleCRM/Controller.php",{action:"FireAffiliatePixel",data:jsonObj})}}}]),module.factory("ServiceHit",["$routeParams",function(e){return{get:function(t,n){var r="http://"+config.general.instance+".trianglecrm.com/pixel/hit.js?aff="+e.aff+"&sub="+e.sub+"&pid="+t+"&cid="+n;return r}}}]),module.factory("ServiceCvv",function(){return{get:function(e,t){var n="";return void 0==e?n="Please select a Card Type first":void 0==t||(1==e?4!=t.toString().length&&(n="The CVV number for AMEX should have 4 digits"):3!=t.toString().length&&(n="The CVV number for Visa, MasterCard and Discover should have 3 digits")),n}}}),module.factory("ServiceCvv",function(){return{get:function(e,t){var n="";return void 0==e?n="Please select a Card Type first":void 0==t||(1==e?4!=t.toString().length&&(n="The CVV number for AMEX should have 4 digits"):3!=t.toString().length&&(n="The CVV number for Visa, MasterCard and Discover should have 3 digits")),n}}}),module.factory("ServiceCc",function(){return{get:function(e,t){var n="";return void 0==e?n="Please select a Card Type first":void 0==t||(1==e?15!=t.toString().length&&(n="The credit card number for AMEX should have 15 digits"):16!=t.toString().length&&(n="The credit card number for Visa, MasterCard and Discover should have 15 digits")),n}}}),module.factory("ServiceDate",function(){return{get:function(e){var t=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),n=new Array("January","February","March","April","May","June","July","August","September","October","November","December"),r=new Date;r.setDate(r.getDate()+e);var o=t[r.getDay()]+", "+n[r.getMonth()]+" "+r.getDate()+", "+r.getFullYear();return o}}}),module.controller("CcCtrl",function(e,t,n,r,o,c,i,a,l,s,u,f){billingInfo=a.get("billingInfo"),e.ver=n.ver||1,e.showEl=orderShowEl,e.showElOp=orderShowElOp,e.templates={header:"templates/headers/header.html",templateCC:"templates/forms/ccTemplate.html",footer:"templates/footers/footer.html",1:"templates/contents/billing.html",content2:"templates/contents/step2-order.html"},e.ccinfo={},e.currentYear=(new Date).getFullYear(),e.currentMonth=(new Date).getMonth()+1,e.months=t.DATETIME_FORMATS.MONTH,void 0!=billingInfo||orderShowEl.shippingForm||(r.location.href="#/?redirected=1"),e.ccinfo.trialPackageID=orderSettings.trialPackageID,e.ccinfo.chargeForTrial=orderSettings.chargeForTrial,e.ccinfo.planID=orderSettings.planID,e.ccinfo.campaignID=orderSettings.campaign_id,e.ccinfo.firstName=billingInfo.firstName,e.ccinfo.lastName=billingInfo.lastName,e.ccinfo.address1=billingInfo.address1,e.ccinfo.address2=billingInfo.address2||"",e.ccinfo.city=billingInfo.city,e.ccinfo.state=billingInfo.state,e.ccinfo.zip=billingInfo.zip,e.ccinfo.country=billingInfo.country,e.ccinfo.phone=billingInfo.phone,e.ccinfo.email=billingInfo.email,e.ccinfo.sendConfirmationEmail=orderSettings.sendConfirmationEmail,e.ccinfo.affiliate=n("aff")||"",e.ccinfo.subAffiliate=n("sub")||"",e.ccinfo.prospectID=billingInfo.ProspectID,e.ccinfo.description=orderSettings.description,e.save=function(){$("#button-processing").show(),$("#button-submit").hide();var t=e.ccinfo.creditCard;return e.ccinfo.creditCard=l.encryptData(t),jsonObj=JSON.stringify(e.ccinfo),o.post("CreateSubscription",jsonObj).then(function(n){"Success"==n.data.State||"Test charge. ERROR"==n.data.Info?(internal=!0,r.location.href="#/"+config.siteFlow.three):($("#button-processing").hide(),$("#button-submit").show(),e.ccinfo.creditCard=t,i.alert(n.data.Info))}),!1},e.typeChange=function(){var t=e.ccinfo.paymentType;1==t?($("#cc_number").attr("pattern","{15}"),$("#cc_number").attr("maxlength","15"),$("#cc_number").mask("9999-999999-99999"),$("#cc_cvv").attr("pattern","[0-9]{4}"),$("#cc_cvv").mask("9999"),$("#cc_cvv").attr("maxlength","4")):($("#cc_number").attr("pattern","{13,16}"),$("#cc_number").attr("maxlength","16"),$("#cc_number").mask("9999-9999-9999-9999"),$("#cc_cvv").attr("pattern","[0-9]{3}"),$("#cc_cvv").mask("999"),$("#cc_cvv").attr("maxlength","3"))},e.getDate=function(e){return f.get(e)},e.ccCheck=function(){var t=u.get(e.ccinfo.paymentType,$("#cc_number").val());t&&i.alert(t)},e.cvvCheck=function(){var t=s.get(e.ccinfo.paymentType,$("#cc_cvv").val());t&&i.alert(t)},c.get(pageId,billingInfo.ProspectID).then(function(t){e.pixel=t.data.Result}),e.status="ready"}),module.controller("InfoCtrl",["$scope","$window","$routeParams","$location","$sce","ServiceHandler","ServicePixel","AlertHandler","BakeCookie","ServiceDate","ServiceHit",function(e,t,n,r,o,c,i,a,l,s,u){e.ver=n.ver||1,1==r.search().redirected&&a.alert("You're here because this information is needed"),e.templates={header:"templates/headers/header.html",templateBill:"templates/forms/billingTemplate.html",footer:"templates/footers/footer.html",1:"templates/contents/index.html"},e.billinfo={},e.billinfo.productTypeID=config.IndexBootstrap.ProductTypeID,e.billinfo.affiliate=n.aff,e.billinfo.subAffiliate=n.sub,e.billinfo.customField1=n.click_id,e.billinfo.country="US",e.showEl=indexShowEl,e.save=function(e){return $("#button-submit").hide(),$("#button-processing").show(),jsonObj=JSON.stringify(e),c.post("createprospect",jsonObj).then(function(n){"Success"==n.data.State?(e.ProspectID=n.data.Result.ProspectID,l.set("billingInfo",e),internal=!0,t.location.href="#/"+config.siteFlow.two):($("#button-processing").hide(),$("#button-submit").show(),a.alert(n.data.Info))}),!1},e.getDate=function(e){return s.get(e)},i.get(pageId,"").then(function(t){e.pixel=t.data.Result}),e.scripts={script:{src:o.trustAsResourceUrl(u.get(pageId,""))}},e.status="ready"}]),module.controller("SuccessCtrl",function(e){e.templates={header:"templates/headers/header.html",footer:"templates/footers/footer.html",content:"templates/contents/success.html"},e.status="ready"}),module.controller("UpCtrl",function(e,t,n,r,o,c,i,a,l,s,u,f){billingInfo=s.get("billingInfo"),ccInfo=s.get("ccInfo"),e.templates={1:"templates/contents/upsellTemplate.html"},e.up={},e.showCc=!1,e.currentYear=(new Date).getFullYear(),e.currentMonth=(new Date).getMonth()+1,e.months=t.DATETIME_FORMATS.MONTH,void 0==billingInfo&&(r.location.href="#/?redirected=1"),void 0==ccInfo&&(e.showCc=!0),e.up.amount=upsellSettings.amount,e.up.shipping=upsellSettings.shipping,e.up.productTypeID=upsellSettings.productTypeID,e.up.productID=upsellSettings.productID,e.up.campaignID=upsellSettings.campaign_id,e.up.firstName=billingInfo.firstName,e.up.lastName=billingInfo.lastName,e.up.address1=billingInfo.address1,e.up.address2=billingInfo.address2||"",e.up.city=billingInfo.city,e.up.state=billingInfo.state,e.up.zip=billingInfo.zip,e.up.country=billingInfo.country,e.up.phone=billingInfo.phone,e.up.email=billingInfo.email,e.up.paymentType=ccInfo.paymentType,e.up.creditCard=ccInfo.creditCard,e.up.cvv=ccInfo.cvv,e.up.expMonth=ccInfo.expMonth,e.up.expYear=ccInfo.expYear,e.up.sendConfirmationEmail=upsellSettings.sendConfirmationEmail,e.up.affiliate=n("aff")||"",e.up.subAffiliate=n("sub")||"",e.up.customField1=n.click_id,e.up.prospectID=billingInfo.ProspectID,e.up.description=upsellSettings.description,e.save=function(){$("#button-processing").show(),$("#button-submit").hide();var t=e.up.creditCard;return e.up.creditCard=u.encryptData(t),jsonObj=JSON.stringify(e.up),a.post("Charge",jsonObj).then(function(n){"Success"==n.data.State||"Test charge. ERROR"==n.data.Info?(internal=!0,r.location.href="#/"+config.siteFlow.three):($("#button-processing").hide(),$("#button-submit").show(),e.ccinfo.creditCard=t,l.alert(n.data.Info))}),!1},e.typeChange=function(){var t=e.ccinfo.paymentType;1==t?($("#cc_number").attr("pattern","{15}"),$("#cc_number").attr("maxlength","15"),$("#cc_number").mask("9999-999999-99999"),$("#cc_cvv").attr("pattern","[0-9]{4}"),$("#cc_cvv").mask("9999"),$("#cc_cvv").attr("maxlength","4")):($("#cc_number").attr("pattern","{13,16}"),$("#cc_number").attr("maxlength","16"),$("#cc_number").mask("9999-9999-9999-9999"),$("#cc_cvv").attr("pattern","[0-9]{3}"),$("#cc_cvv").mask("999"),$("#cc_cvv").attr("maxlength","3"))},e.getDate=function(e){return c.get(e)},e.ccCheck=function(){var t=i.get(e.ccinfo.paymentType,$("#cc_number").val());t&&l.alert(t)},e.cvvCheck=function(){var t=o.get(e.ccinfo.paymentType,$("#cc_cvv").val());t&&l.alert(t)},f.get(pageId,billingInfo.ProspectID).then(function(t){e.pixel=t.data.Result}),e.status="ready"});