!function(e){"use strict";var t=e.module("ngLoadScript",[]);t.directive("script",function(){return{restrict:"E",scope:!1,link:function(e,t,n){if("text/javascript-lazy"===n.type){var r=t.text(),i=new Function(r);i()}}}})}(angular),angular.module("HashBangURLs",[]).config(["$locationProvider",function(e){e.hashPrefix("!")}]);var module=angular.module("app",["ngCookies","ngRoute","HashBangURLs"]);module.directive("script",function(){return{restrict:"E",scope:!1,link:function(e,t,n){if("text/javascript-lazy"===n.type){var r=document.createElement("script");r.type="text/javascript";var i=t.attr("src");if(void 0!==i)r.src=i;else{var c=t.text();r.text=c}document.head.appendChild(r),t.remove()}}}}),module.config(["$locationProvider",function(){}]),module.config(function(e){e.when("/",{templateUrl:"/templates/holders/home.html",controller:"InfoCtrl"}).when("/Home",{templateUrl:"/templates/holders/home.html",controller:"InfoCtrl"}).when("/Billing",{templateUrl:"/templates/contents/billing.html",controller:"CcCtrl"}).when("/Success",{templateUrl:"/templates/contents/success.html",controller:"SuccessCtrl"}).when("/Upsell",{templateUrl:"/templates/contents/upsell.php",controller:"UpCtrl"}).otherwise({redirectTo:"/"})}),module.filter("range",function(){var e=function(e,t,n){for(var r=t;n>=r;r++)e.push(r);return e};return e}),module.filter("to_trusted",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),module.directive("cardExpiration",function(e){var t={require:"ngModel",link:function(t){t.$watch("[ccinfo.expMonth,ccinfo.expYear]",function(){return""!=t.ccinfo.expMonth&&""!=t.ccinfo.expYear&&(today=new Date,selected=new Date,selected.setMonth(t.ccinfo.expMonth),selected.setYear(t.ccinfo.expYear),today>=selected)?(e.alert("Please select a valid date!"),t.ccinfo.expYear="",t.ccinfo.expMonth="",!1):!0},!0)}};return t}),module.directive("staticInclude",["$http","$templateCache","$compile","$timeout",function(e,t,n,r){return function(i,c,o){r(function(){var r=o.staticInclude;e.get(r,{cache:t}).success(function(e){var t=c.html(e).contents();n(t)(i)})},"1500")}}]),module.directive("onlyDigits",function(){return{require:"ngModel",restrict:"A",link:function(e,t,n,r){function i(e){if(e){var t=e.replace(/[^0-9]/g,"");return t!==e&&(r.$setViewValue(t),r.$render()),parseInt(t,10)}return void 0}r.$parsers.push(i)}}}),module.factory("AlertHandler",function(){return{alert:function(e){jError("<div>We are sorry but we could not process your request.<br/><h2>"+e+"</h2>Please correct and try again.</div>",{autoHide:!0,TimeShown:3e3,HorizontalPosition:"center",onCompleted:function(){}})}}}),module.factory("ServiceHandler",["$http",function(e){return{post:function(t,n){return e.post("TriangleCRM/Controller.php",{action:t,data:n})}}}]),module.factory("BakeCookie",function(e){return{set:function(t,n){e.put(t,n)},remove:function(t){e.remove(t)},get:function(t){return e.get(t)}}}),module.factory("encrypt",function(){return{encryptData:function(e){var t="-----BEGIN PUBLIC KEY-----MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAM1RXGYKyXlCGcGvFYeNCD+yzVAOoK+w2awyE6vOCSqhR0pAWFgpWOuwbrL5M78PILmZc85ipbzoz6Vtv4IvYJUCAwEAAQ==-----END PUBLIC KEY-----",n=RSA.getPublicKey(t);return RSA.encrypt(e,n)}}}),module.factory("ParameterByName",function(){return{get:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))}}}),module.factory("ServicePixel",["$http","$routeParams",function(e,t){return{get:function(n,r){var i={};return i.affiliate=t.aff||"",i.clickId=t.click_id||"",i.pageTypeID=n,i.prospectID=r,jsonObj=JSON.stringify(i),e.post("TriangleCRM/Controller.php",{action:"FireAffiliatePixel",data:jsonObj})}}}]),module.factory("ServiceHit",["$routeParams",function(e){return{get:function(t,n){var r="http://"+config.general.instance+".trianglecrm.com/pixel/hit.js?aff="+e.aff+"&sub="+e.sub+"&pid="+t+"&cid="+n;return r}}}]),module.factory("ServiceCvv",function(){return{get:function(e,t){var n="";return void 0==e?n="Please select a Card Type first":void 0==t||(1==e?4!=t.toString().length&&(n="The CVV number for AMEX should have 4 digits"):3!=t.toString().length&&(n="The CVV number for Visa, MasterCard and Discover should have 3 digits")),n}}}),module.factory("ServiceCvv",function(){return{get:function(e,t){var n="";return void 0==e?n="Please select a Card Type first":void 0==t||(1==e?4!=t.toString().length&&(n="The CVV number for AMEX should have 4 digits"):3!=t.toString().length&&(n="The CVV number for Visa, MasterCard and Discover should have 3 digits")),n}}}),module.factory("ServiceCc",function(){return{get:function(e,t){var n="";return void 0==e?n="Please select a Card Type first":void 0==t||(1==e?15!=t.toString().length&&(n="The credit card number for AMEX should have 15 digits"):16!=t.toString().length&&(n="The credit card number for Visa, MasterCard and Discover should have 15 digits")),n}}}),module.factory("ServiceDate",function(){return{get:function(e){var t=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),n=new Array("January","February","March","April","May","June","July","August","September","October","November","December"),r=new Date;r.setDate(r.getDate()+e);var i=t[r.getDay()]+", "+n[r.getMonth()]+" "+r.getDate()+", "+r.getFullYear();return i}}}),module.controller("CcCtrl",function(e,t,n,r,i,c,o,a,l,s,u,f,d){billingInfo=l.get("billingInfo"),ver=n.ver||0,orderSettings=config[ver].billing,downSell=orderSettings.downsell||"",downSellImg=orderSettings.downSellImg||"",aff=n.aff||"",sub=n.sub||"",e.showEl=orderSettings,e.templates={templateCC:"templates/forms/ccTemplate.html"},e.ccinfo={},e.currentYear=(new Date).getFullYear(),e.currentMonth=(new Date).getMonth()+1,e.months=t.DATETIME_FORMATS.MONTH,void 0==billingInfo&&(r.location.href="#/?redirected=1&aff="+aff+"&sub="+sub),e.ccinfo.trialPackageID=orderSettings.trialPackageID,e.ccinfo.chargeForTrial=orderSettings.chargeForTrial,e.ccinfo.planID=orderSettings.planID,e.ccinfo.campaignID=orderSettings.campaign_id,e.ccinfo.firstName=billingInfo.firstName,e.ccinfo.lastName=billingInfo.lastName,e.ccinfo.address1=billingInfo.address1,e.ccinfo.address2=billingInfo.address2||"",e.ccinfo.city=billingInfo.city,e.ccinfo.state=billingInfo.state,e.ccinfo.zip=billingInfo.zip,e.ccinfo.country=billingInfo.country,e.ccinfo.phone=billingInfo.phone,e.ccinfo.email=billingInfo.email,e.ccinfo.sendConfirmationEmail=orderSettings.sendConfirmationEmail,e.ccinfo.affiliate=n.aff||"",e.ccinfo.subAffiliate=n.sub||"",e.ccinfo.prospectID=billingInfo.ProspectID,e.ccinfo.description=orderSettings.description,e.save=function(){$("#button-processing").show(),$("#button-submit").hide();var t=e.ccinfo.creditCard;t=t.toString().replace(/-/g,""),e.ccinfo.creditCard=s.encryptData(t);var n={creditCard:e.ccinfo.creditCard,productID:orderSettings.projectID};return c.post("IsCreditCardDupe",n).then(function(n){"Success"==n.data.State||"Test charge. ERROR"==n.data.Info?(jsonObj=JSON.stringify(e.ccinfo),c.post("CreateSubscription",jsonObj).then(function(n){"Success"==n.data.State||"Test charge. ERROR"==n.data.Info?(l.set("ccInfo",info),internal=!0,r.location.href=orderSettings.successRedirect):(e.proccessing=!1,e.submitBtn=!0,e.ccinfo.creditCard=t,a.alert(n.data.Info))})):($("#button-processing").hide(),$("#button-submit").show(),e.ccinfo.creditCard=t,a.alert("This Credit Card is a dupe in our system."))}),!1},e.typeChange=function(){var t=e.ccinfo.paymentType;1==t?($("#cc_number").attr("pattern","{15}"),$("#cc_number").attr("maxlength","15"),$("#cc_number").mask("9999-999999-99999"),$("#cc_cvv").attr("pattern","[0-9]{4}"),$("#cc_cvv").mask("9999"),$("#cc_cvv").attr("maxlength","4")):($("#cc_number").attr("pattern","{13,16}"),$("#cc_number").attr("maxlength","16"),$("#cc_number").mask("9999-9999-9999-9999"),$("#cc_cvv").attr("pattern","[0-9]{3}"),$("#cc_cvv").mask("999"),$("#cc_cvv").attr("maxlength","3"))},e.getDate=function(e){return d.get(e)},e.ccCheck=function(){var t=f.get(e.ccinfo.paymentType,$("#cc_number").val());t&&a.alert(t)},e.cvvCheck=function(){var t=u.get(e.ccinfo.paymentType,$("#cc_cvv").val());t&&a.alert(t)},o.get(pageId,billingInfo.ProspectID).then(function(t){e.pixel=t.data.Result}),e.scripts={script:{src:i.trustAsResourceUrl(ServiceHit.get(pageId,""))}},e.status="ready"}),module.controller("InfoCtrl",["$scope","$window","$routeParams","$location","$sce","ServiceHandler","ServicePixel","AlertHandler","BakeCookie","ServiceDate","ServiceHit",function(e,t,n,r,i,c,o,a,l,s,u){1==r.search().redirected&&a.alert("You're here because this information is needed"),e.templates={templateBill:"templates/forms/billingTemplate.html"},e.billinfo={},e.billinfo.productTypeID=indexInfo.ProductTypeID,e.billinfo.affiliate=n.aff,e.billinfo.subAffiliate=n.sub,e.billinfo.customField1=n.click_id,e.billinfo.country=indexInfo.selectedCountry||"US",e.showEl=indexInfo,e.save=function(n){return e.proccessing=!0,e.submitBtn=!1,jsonObj=JSON.stringify(n),c.post("createprospect",jsonObj).then(function(r){"Success"==r.data.State?(n.ProspectID=r.data.Result.ProspectID,l.set("billingInfo",n),internal=!0,t.location.href=indexInfo.successRedirect):(e.proccessing=!1,e.submitBtn=!0,a.alert(r.data.Info))}),!1},e.getDate=function(e){return s.get(e)},o.get(pageId,"").then(function(t){e.pixel=t.data.Result}),e.scripts={script:{src:i.trustAsResourceUrl(u.get(pageId,""))}},e.status="ready"}]),module.controller("SuccessCtrl",function(e,t,n,r,i){e.billingInfo=n.get("billingInfo"),e.name=e.billingInfo.firstName,console.log(e.billingInfo.firstName),void 0==e.billingInfo&&($window.location.href="#/?redirected=1"),r.get(pageId,e.billingInfo.ProspectID).then(function(t){e.pixel=t.data.Result}),e.scripts={script:{src:t.trustAsResourceUrl(i.get(pageId,""))}},e.status="ready"}),module.controller("UpCtrl",function(e,t,n,r,i,c,o,a,l,s,u,f){billingInfo=s.get("billingInfo"),void 0==billingInfo&&(r.location.href="#/?redirected=1"),ccInfo=s.get("ccInfo"),void 0==ccInfo&&(e.showCc=!0),e.templates={templateUpsell:"templates/forms/upsellTemplate.html"},e.up={},e.showCc=!1,e.currentYear=(new Date).getFullYear(),e.currentMonth=(new Date).getMonth()+1,e.months=t.DATETIME_FORMATS.MONTH,e.up.amount=upsellSettings.amount,e.up.shipping=upsellSettings.shipping,e.up.productTypeID=upsellSettings.productTypeID,e.up.productID=upsellSettings.productID,e.up.campaignID=upsellSettings.campaign_id,e.up.firstName=billingInfo.firstName,e.up.lastName=billingInfo.lastName,e.up.address1=billingInfo.address1,e.up.address2=billingInfo.address2||"",e.up.city=billingInfo.city,e.up.state=billingInfo.state,e.up.zip=billingInfo.zip,e.up.country=billingInfo.country,e.up.phone=billingInfo.phone,e.up.email=billingInfo.email,e.up.paymentType=ccInfo.paymentType,e.up.creditCard=ccInfo.creditCard,e.up.cvv=ccInfo.cvv,e.up.expMonth=ccInfo.expMonth,e.up.expYear=ccInfo.expYear,e.up.sendConfirmationEmail=upsellSettings.sendConfirmationEmail,e.up.affiliate=n.aff||"",e.up.subAffiliate=n.sub||"",e.up.customField1=n.click_id||"",e.up.prospectID=billingInfo.ProspectID,e.up.description=upsellSettings.description,e.save=function(){e.proccessing=!0,e.submitBtn=!1;var t=e.up.creditCard;return t=t.toString().replace(/-/g,""),e.up.creditCard=u.encryptData(t),jsonObj=JSON.stringify(e.up),a.post("Charge",jsonObj).then(function(n){"Success"==n.data.State||"Test charge. ERROR"==n.data.Info?(internal=!0,r.location.href=upsellSettings.successRedirect):(e.proccessing=!0,e.submitBtn=!1,e.ccinfo.creditCard=t,l.alert(n.data.Info))}),!1},e.typeChange=function(){var t=e.ccinfo.paymentType;1==t?($("#cc_number").attr("pattern","{15}"),$("#cc_number").attr("maxlength","15"),$("#cc_number").mask("9999-999999-99999"),$("#cc_cvv").attr("pattern","[0-9]{4}"),$("#cc_cvv").mask("9999"),$("#cc_cvv").attr("maxlength","4")):($("#cc_number").attr("pattern","{13,16}"),$("#cc_number").attr("maxlength","16"),$("#cc_number").mask("9999-9999-9999-9999"),$("#cc_cvv").attr("pattern","[0-9]{3}"),$("#cc_cvv").mask("999"),$("#cc_cvv").attr("maxlength","3"))},e.getDate=function(e){return c.get(e)},e.ccCheck=function(){var t=o.get(e.ccinfo.paymentType,$("#cc_number").val());t&&l.alert(t)},e.cvvCheck=function(){var t=i.get(e.ccinfo.paymentType,$("#cc_cvv").val());t&&l.alert(t)},f.get(pageId,billingInfo.ProspectID).then(function(t){e.pixel=t.data.Result}),e.status="ready"});